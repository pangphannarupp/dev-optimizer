import{j as e,m as ee,bD as G,t as te,o as V,X as se,S as re,a1 as ae,a2 as ne,V as U,aB as ie}from"./ui-vendor-DEvE63cZ.js";import{r as a}from"./react-vendor-BGp5FbCG.js";import{u as le}from"./index-QRt--NjA.js";import{m as k,A as oe}from"./framer-vendor-DEiCTn3G.js";import"./utils-vendor-CJFcDo9C.js";const F={standard:{label:"Standard",rate:1,pitch:1,description:"Natural and balanced"},storyteller:{label:"Storyteller",rate:.9,pitch:1.1,description:"Slower, engaging tone"},serious:{label:"Serious",rate:.85,pitch:.8,description:"Deep and authoritative"},excited:{label:"Excited",rate:1.2,pitch:1.3,description:"Fast and energetic"},whisper:{label:"Soft",rate:.9,pitch:1.4,description:"Gentle and higher pitch"}},ue=()=>{const{t:r}=le(),[l,I]=a.useState(""),[c,g]=a.useState(!1),[o,u]=a.useState(!1),[m,p]=a.useState(null),[h,w]=a.useState(!1),[v,f]=a.useState(null),[B,y]=a.useState(!1),[b,K]=a.useState([]),[x,N]=a.useState(null),[O,S]=a.useState("standard"),[A,L]=a.useState(1),[C,D]=a.useState(1),[H]=a.useState(1),d=a.useRef(window.speechSynthesis),W=a.useRef(null),j=a.useRef(null),R=a.useRef([]),[q,T]=a.useState(new Array(20).fill(10));a.useEffect(()=>{let t;const s=()=>{T(c&&!o?n=>n.map(()=>10+Math.random()*40):new Array(20).fill(5)),t=requestAnimationFrame(s)};return c&&!o?s():T(new Array(20).fill(5)),()=>cancelAnimationFrame(t)},[c,o]);const E=/[\u1780-\u17FF]/.test(l),P=b.some(t=>t.lang.startsWith("km"));a.useEffect(()=>{const t=()=>{const s=d.current.getVoices();if(K(s),!x&&s.length>0){const n=s.find(i=>i.name.includes("Google")||i.name.includes("Premium")||i.name.includes("Enhanced")||i.name==="Samantha");N(n||s[0])}};return t(),speechSynthesis.onvoiceschanged!==void 0&&(speechSynthesis.onvoiceschanged=t),()=>{speechSynthesis.onvoiceschanged!==void 0&&(speechSynthesis.onvoiceschanged=null),d.current.cancel()}},[x]),a.useEffect(()=>{if(E&&P&&x&&!x.lang.startsWith("km")){const t=b.find(s=>s.lang.startsWith("km"));t&&N(t)}},[E,P,b,x]);const Q=t=>{S(t),L(F[t].rate),D(F[t].pitch)},X=t=>{const s=new SpeechSynthesisUtterance(t);return x&&(s.voice=x),s.rate=A,s.pitch=C,s.volume=H,s.onboundary=n=>{n.name==="word"&&p({start:n.charIndex,end:n.charIndex+n.charLength})},s.onend=()=>{g(!1),u(!1),p(null),h&&M()},s.onerror=n=>{console.error("Speech Error:",n),g(!1),u(!1),p(null),h&&M()},s},z=()=>{if(o)d.current.resume(),u(!1),g(!0);else if(d.current.speaking&&d.current.cancel(),l.trim()){const t=X(l);W.current=t,d.current.speak(t),g(!0)}},$=()=>{d.current.cancel(),g(!1),u(!1),p(null),h&&M()},Y=async()=>{try{const t=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});if(!t.getAudioTracks().length){alert("Please share 'Tab Audio' to enable recording."),t.getTracks().forEach(i=>i.stop());return}const s=MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4",n=new MediaRecorder(t,{mimeType:s});j.current=n,R.current=[],n.ondataavailable=i=>{i.data.size>0&&R.current.push(i.data)},n.onstop=()=>{const i=new Blob(R.current,{type:s});f(i),w(!1),t.getTracks().forEach(_=>_.stop())},n.start(),w(!0),z()}catch(t){console.error("Recording setup failed:",t);let s="Recording failed to start.";t instanceof DOMException&&(t.name==="NotAllowedError"?s="Recording cancelled or permission denied. Please click 'Share' in the popup (and ensure Audio is checked).":t.name==="NotSupportedError"?s="Screen recording is not supported in this browser context (e.g., HTTP vs HTTPS).":s=`Error: ${t.message}. Please click the button directly.`),alert(s),w(!1)}},M=()=>{j.current&&j.current.state!=="inactive"&&j.current.stop()},J=()=>{if(!v)return;const t=URL.createObjectURL(v),s=document.createElement("a");s.href=t,s.download=`voice-studio-${Date.now()}.webm`,s.click(),URL.revokeObjectURL(t),f(null)},Z=()=>{if(!m)return l;const t=l.substring(0,m.start),s=l.substring(m.start,m.end),n=l.substring(m.end);return e.jsxs(e.Fragment,{children:[t,e.jsx("span",{className:"bg-blue-200 dark:bg-blue-900 text-blue-800 dark:text-blue-100 px-0.5 rounded animate-pulse transition-all duration-75",children:s}),n]})};return e.jsx("div",{className:"min-h-full w-full bg-gray-50 dark:bg-gray-900 p-4 md:p-8 font-sans",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 flex items-center gap-3",children:[e.jsx(ee,{className:"w-8 h-8 text-blue-600 dark:text-blue-400",strokeWidth:2.5}),r("screenAudio.title")]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1 font-medium",children:r("screenAudio.subtitle")})]}),e.jsx("div",{className:"h-12 flex items-center gap-1 bg-white dark:bg-gray-800 px-4 py-2 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm",children:q.map((t,s)=>e.jsx(k.div,{animate:{height:`${t}%`},transition:{type:"spring",stiffness:300,damping:20},className:`w-1.5 rounded-full ${c&&!o?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`},s))})]}),E&&!P&&e.jsxs(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-xl p-4 flex items-center gap-3 text-amber-800 dark:text-amber-200",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-800 rounded-full",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold",children:r("screenAudio.khmerMissingTitle")}),e.jsx("p",{className:"text-sm opacity-90",children:r("screenAudio.khmerMissingText")})]}),e.jsxs("button",{onClick:()=>y(!0),className:"bg-amber-200 dark:bg-amber-800 hover:bg-amber-300 dark:hover:bg-amber-700 text-amber-900 dark:text-amber-100 px-3 py-1.5 rounded-lg text-sm font-semibold transition-colors flex items-center gap-1.5",children:[e.jsx(te,{size:14}),r("screenAudio.installVoice")]})]}),e.jsx(oe,{children:B&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:()=>y(!1),children:e.jsxs(k.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-white dark:bg-gray-800 z-10",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-500"}),r("screenAudio.installModalTitle")]}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 p-1",children:e.jsx(se,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Note:"})," ",r("screenAudio.installModalNote")]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center text-xs",children:"1"}),r("screenAudio.windows")]}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-2",children:[e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Settings"})," ",">"," ",e.jsx("strong",{children:"Time & Language"}),"."]}),e.jsxs("li",{children:["Select ",e.jsx("strong",{children:"Speech"}),' (or "Region & Language").']}),e.jsxs("li",{children:['Under "Manage voices", click ',e.jsx("strong",{children:"Add voices"}),"."]}),e.jsxs("li",{children:["Search for ",e.jsx("strong",{children:'"Khmer"'}),' and select "Khmer (Cambodia)".']}),e.jsxs("li",{children:["Click ",e.jsx("strong",{children:"Add"})," and wait for the download to finish."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Restart your browser"})," to see the new voice."]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full flex items-center justify-center text-xs",children:"2"}),r("screenAudio.mac")]}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-2",children:[e.jsxs("li",{children:["Open ",e.jsx("strong",{children:"System Settings"})," (or Preferences)."]}),e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Accessibility"})," ",">"," ",e.jsx("strong",{children:"Spoken Content"}),"."]}),e.jsx("li",{children:'Click the drop-down for "System Voice".'}),e.jsxs("li",{children:["Select ",e.jsx("strong",{children:"Manage Voices..."})]}),e.jsxs("li",{children:["Search for ",e.jsx("strong",{children:'"Khmer"'}),"."]}),e.jsx("li",{children:"Click the download icon (cloud) next to the voice."}),e.jsxs("li",{children:[e.jsx("strong",{children:"Restart your browser"}),"."]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400 rounded-full flex items-center justify-center text-xs",children:"3"}),r("screenAudio.android")]}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-2",children:[e.jsxs("li",{children:["Go to ",e.jsx("strong",{children:"Settings"})," ",">"," ",e.jsx("strong",{children:"Accessibility"}),"."]}),e.jsxs("li",{children:["Tap ",e.jsx("strong",{children:"Text-to-speech output"}),"."]}),e.jsx("li",{children:'Tap the gear icon next to "Preferred engine".'}),e.jsxs("li",{children:["Tap ",e.jsx("strong",{children:"Install voice data"}),"."]}),e.jsxs("li",{children:["Find ",e.jsx("strong",{children:"Khmer (Cambodia)"})," and download it."]})]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 rounded-b-2xl",children:e.jsx("button",{onClick:()=>y(!1),className:"w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold transition-colors",children:r("screenAudio.gotIt")})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-gray-500"}),r("screenAudio.voiceSettings")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500 font-medium mb-1.5 block",children:r("screenAudio.characterVoice")}),e.jsx("select",{value:x?.name||"",onChange:t=>{const s=b.find(n=>n.name===t.target.value);s&&N(s)},className:"w-full bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm",children:b.map(t=>e.jsxs("option",{value:t.name,children:[t.name," (",t.lang,")"]},t.name))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:r("screenAudio.speed")}),e.jsxs("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-300",children:[A,"x"]})]}),e.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:A,onChange:t=>{L(parseFloat(t.target.value)),S("standard")},className:"w-full accent-blue-600 bg-gray-200 dark:bg-gray-700 rounded-lg h-2 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:r("screenAudio.pitch")}),e.jsx("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-300",children:C})]}),e.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:C,onChange:t=>{D(parseFloat(t.target.value)),S("standard")},className:"w-full accent-blue-600 bg-gray-200 dark:bg-gray-700 rounded-lg h-2 cursor-pointer"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-amber-500"}),r("screenAudio.emotiveStyles")]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(F).map(t=>e.jsx("button",{onClick:()=>Q(t),className:`px-3 py-2.5 rounded-xl text-sm font-medium transition-all ${O===t?"bg-blue-600 text-white shadow-md shadow-blue-500/30 ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-800":"bg-gray-50 dark:bg-gray-700/50 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:r(`screenAudio.styles.${t}`)},t))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-green-500"}),r("screenAudio.exportAudio")]}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:r("screenAudio.exportNote")}),v?e.jsxs("button",{onClick:J,className:"w-full py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg shadow-green-500/30 transition-all",children:[e.jsx(V,{size:18}),r("screenAudio.saveRecording")]}):e.jsx("button",{onClick:Y,disabled:c||h||!l,className:`w-full py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${h?"bg-red-500 text-white animate-pulse":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"} disabled:opacity-50`,children:r(h?"screenAudio.recordingState":"screenAudio.recordToDownload")})]})]}),e.jsxs("div",{className:"lg:col-span-2 flex flex-col h-[600px]",children:[e.jsxs("div",{className:"flex-1 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-1 flex flex-col relative group overflow-hidden",children:[c&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsxs("button",{onClick:$,className:"flex items-center gap-2 bg-gray-900/10 backdrop-blur-md px-3 py-1.5 rounded-full text-xs font-medium text-gray-500 hover:bg-red-100 hover:text-red-500 transition-colors",children:[e.jsx(ae,{size:12}),r("screenAudio.editText")]})}),c?e.jsx("div",{className:"w-full h-full p-6 text-xl leading-relaxed text-gray-800 dark:text-gray-100 font-serif overflow-y-auto whitespace-pre-wrap",children:Z()}):e.jsx("textarea",{value:l,onChange:t=>{I(t.target.value),f(null)},placeholder:"Enter your script here to convert to speech...",className:"w-full h-full p-6 bg-transparent border-0 outline-none resize-none text-xl leading-relaxed text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600 font-serif"})]}),e.jsxs("div",{className:"mt-6 flex flex-col-reverse md:flex-row items-center gap-4",children:[e.jsx("button",{onClick:()=>{I(""),f(null)},className:"text-sm text-gray-500 hover:text-red-500 transition-colors py-2",children:r("screenAudio.clearScript")}),e.jsxs("div",{className:"flex-1 flex justify-center gap-4",children:[e.jsx("button",{onClick:$,disabled:!c&&!o,className:"w-12 h-12 flex items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 transition-all",title:"Stop",children:e.jsx(ne,{size:20,fill:"currentColor"})}),!c&&!o?e.jsxs("button",{onClick:z,disabled:!l,className:"h-14 px-8 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-600/30 hover:shadow-blue-600/50 hover:scale-105 active:scale-95 transition-all flex items-center gap-3 text-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[e.jsx(U,{size:26,fill:"currentColor"}),r("screenAudio.startReading")]}):e.jsx("button",{onClick:o?z:()=>{d.current.speaking&&!d.current.paused&&(d.current.pause(),u(!0),g(!1))},className:`h-14 px-8 rounded-full text-white shadow-lg transition-all flex items-center gap-3 text-lg font-bold hover:scale-105 active:scale-95 ${o?"bg-blue-600 shadow-blue-600/30":"bg-amber-500 hover:bg-amber-600 shadow-amber-500/30"}`,children:o?e.jsxs(e.Fragment,{children:[" ",e.jsx(U,{size:26,fill:"currentColor"})," ",r("screenAudio.resume")," "]}):e.jsxs(e.Fragment,{children:[" ",e.jsx(ie,{size:26,fill:"currentColor"})," ",r("screenAudio.pause")," "]})})]}),e.jsx("div",{className:"w-24"})," "]})]})]})]})})};export{ue as ScreenAudioMaker};
