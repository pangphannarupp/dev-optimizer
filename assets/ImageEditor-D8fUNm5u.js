import{j as t,a1 as le,x as ce,a2 as de,a3 as ge,a4 as he,a5 as M,a6 as ue,a7 as me,a8 as xe,a9 as be,U as pe,o as fe}from"./ui-vendor-DEvE63cZ.js";import{r}from"./react-vendor-BGp5FbCG.js";import{X as ye,o as I,N as je,y as ve,c as we,j as Y,S as O}from"./index.min-C4a0yx6H.js";import{DropZone as ke}from"./DropZone-BveMg_CL.js";import{u as Ce}from"./index-D3BnbEK0.js";import"./framer-vendor-DEiCTn3G.js";import"./utils-vendor-CJFcDo9C.js";const Ae=()=>{const[C,J]=r.useState(null),[e,T]=r.useState(null),[v,R]=r.useState("draw"),[$,U]=r.useState(!1),[h,z]=r.useState(null),[y,P]=r.useState([]),[u,A]=r.useState(-1),[k,q]=r.useState("#3b82f6"),[D,V]=r.useState("#1f2937"),[X]=r.useState(2),[F,Z]=r.useState(32),[N,G]=r.useState(0),[E,K]=r.useState(0),[S,Q]=r.useState(0),L=r.useRef(null),m=r.useRef(null),{t:i}=Ce();r.useEffect(()=>{if(L.current&&!e){const a=new ye(L.current,{width:800,height:600,backgroundColor:"#f3f4f6"});return T(a),()=>{a.dispose(),T(null)}}},[e]);const d=r.useCallback(()=>{if(!e)return;const a=JSON.stringify(e.toJSON()),n=y.slice(0,u+1);n.push(a),P(n),A(n.length-1)},[e,y,u]);r.useEffect(()=>{if(e)return e.on("object:added",d),e.on("object:modified",d),e.on("object:removed",d),()=>{e.off("object:added",d),e.off("object:modified",d),e.off("object:removed",d)}},[e,d]);const _=r.useCallback(()=>{if(u>0&&e){const a=y[u-1];e.loadFromJSON(a).then(()=>{e.renderAll(),A(u-1)})}},[e,y,u]),ee=r.useCallback(()=>{if(u<y.length-1&&e){const a=y[u+1];e.loadFromJSON(a).then(()=>{e.renderAll(),A(u+1)})}},[e,y,u]),te=r.useCallback(a=>{if(a.length>0){if(!e){console.error("Canvas not initialized yet!"),alert(i("imageEditor.alert.waitParams"));return}const n=a[0];J(n);const s=new FileReader;s.onload=async l=>{try{const c=l.target?.result,g=await I.fromURL(c),o=e.width||800,x=e.height||600,p=o/(g.width||1),j=x/(g.height||1),f=Math.max(p,j);g.scale(f),g.selectable=!1,g.set({left:(o-(g.width||0)*f)/2,top:(x-(g.height||0)*f)/2}),e.backgroundImage=g,m.current=g,e.renderAll(),e.backgroundImage=g,m.current=g,e.renderAll(),d()}catch(c){console.error("Error loading image:",c),alert(i("imageEditor.alert.loadError"))}},s.onerror=l=>{console.error("FileReader error:",l),alert(i("imageEditor.alert.readError"))},s.readAsDataURL(n)}},[e,d]),ae=r.useCallback(()=>{if(!e)return;const a=new je(i("imageEditor.clickToEdit"),{left:100,top:100,fontSize:F,fill:k});e.add(a),e.setActiveObject(a)},[e,F,k]),H=r.useCallback(a=>{if(!e)return;let n;const s={left:100,top:100,fill:k,stroke:D,strokeWidth:X};switch(a){case"rectangle":n=new Y({...s,width:100,height:100});break;case"circle":n=new we({...s,radius:50});break;case"triangle":n=new ve({...s,width:100,height:100});break}e.add(n),e.setActiveObject(n)},[e,k,D,X]),W=r.useCallback(async a=>{if(!e||!m.current)return;const s=m.current.getElement(),l=document.createElement("canvas"),c=l.getContext("2d");if(!c||!s)return;a===90||a===270||a===-90||a===-270?(l.width=s.height,l.height=s.width):(l.width=s.width,l.height=s.height),c.translate(l.width/2,l.height/2),c.rotate(a*Math.PI/180),c.drawImage(s,-s.width/2,-s.height/2);const g=l.toDataURL(),o=await I.fromURL(g),x=e.width||800,p=e.height||600,j=x/(o.width||1),f=p/(o.height||1),b=Math.max(j,f);o.scale(b),o.selectable=!1,o.set({left:(x-(o.width||0)*b)/2,top:(p-(o.height||0)*b)/2}),e.backgroundImage=o,m.current=o,e.renderAll(),d()},[e,d]),B=r.useCallback(async a=>{if(!e||!m.current)return;const n=e.toDataURL(),s=new Image;s.onload=async()=>{const l=document.createElement("canvas");l.width=s.width,l.height=s.height;const c=l.getContext("2d");if(!c)return;a==="horizontal"?(c.translate(l.width,0),c.scale(-1,1)):(c.translate(0,l.height),c.scale(1,-1)),c.drawImage(s,0,0);const g=l.toDataURL(),o=await I.fromURL(g),x=e.width||800,p=e.height||600,j=x/(o.width||1),f=p/(o.height||1),b=Math.max(j,f);o.scale(b),o.selectable=!1,o.set({left:(x-(o.width||0)*b)/2,top:(p-(o.height||0)*b)/2}),e.backgroundImage=o,m.current=o,e.renderAll(),d()},s.src=n},[e,d]),re=r.useCallback(()=>{if(!e)return;U(!0);const a=new Y({left:100,top:100,width:300,height:300,fill:"rgba(0,0,0,0.3)",stroke:"#3b82f6",strokeWidth:2,strokeDashArray:[5,5],selectable:!0,hasControls:!0});e.add(a),e.setActiveObject(a),z(a),e.renderAll()},[e]),se=r.useCallback(()=>{if(!e||!h||!m.current)return;const a={left:h.left||0,top:h.top||0,width:(h.width||0)*(h.scaleX||1),height:(h.height||0)*(h.scaleY||1)};e.remove(h),e.renderAll();const n=document.createElement("canvas");n.width=a.width,n.height=a.height;const s=n.getContext("2d");if(s&&e.backgroundImage){const l=e.toDataURL(),c=new Image;c.onload=async()=>{s.drawImage(c,a.left,a.top,a.width,a.height,0,0,a.width,a.height);const g=n.toDataURL(),o=await I.fromURL(g),x=e.width||800,p=e.height||600,j=x/(o.width||1),f=p/(o.height||1),b=Math.min(j,f);o.scale(b),o.selectable=!1,o.set({left:(x-(o.width||0)*b)/2,top:(p-(o.height||0)*b)/2}),e.backgroundImage=o,m.current=o,e.renderAll(),z(null),U(!1),d()},c.src=l}},[e,h,d]),oe=r.useCallback(()=>{!e||!h||(e.remove(h),z(null),U(!1),e.renderAll())},[e,h]),w=r.useCallback((a,n)=>{if(!e||!m.current)return;const s=m.current;s.filters=(s.filters||[]).filter(l=>!(a==="brightness"&&l.type==="Brightness"||a==="contrast"&&l.type==="Contrast"||a==="saturation"&&l.type==="Saturation")),n!==0&&(a==="brightness"?s.filters.push(new O.Brightness({brightness:n/100})):a==="contrast"?s.filters.push(new O.Contrast({contrast:n/100})):a==="saturation"&&s.filters.push(new O.Saturation({saturation:n/100}))),s.applyFilters(),e.renderAll()},[e]),ne=r.useCallback(()=>{if(!e)return;e.getObjects().forEach(n=>e.remove(n)),e.renderAll(),d()},[e,d]),ie=r.useCallback(()=>{if(!e)return;const a=e.toDataURL({format:"png",quality:1,multiplier:1}),n=document.createElement("a");n.href=a,n.download=`edited-${C?.name||"image.png"}`,n.click()},[e,C]);return r.useEffect(()=>{w("brightness",N)},[N,w]),r.useEffect(()=>{w("contrast",E)},[E,w]),r.useEffect(()=>{w("saturation",S)},[S,w]),t.jsx("div",{className:"flex flex-col gap-4 max-w-7xl mx-auto w-full",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(le,{className:"text-indigo-600"}),i("imageEditor.title")]}),t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"relative border-2 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden mx-auto",children:[t.jsx("canvas",{ref:L}),!C&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 dark:bg-gray-900 bg-opacity-90",children:t.jsx(ke,{onFilesDropped:te,className:"w-full h-full min-h-[400px]"})})]}),C&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:()=>R("draw"),className:`px-4 py-2 font-medium transition-colors ${v==="draw"?"border-b-2 border-indigo-600 text-indigo-600":"text-gray-600 dark:text-gray-400"}`,children:i("imageEditor.draw")}),t.jsx("button",{onClick:()=>R("transform"),className:`px-4 py-2 font-medium transition-colors ${v==="transform"?"border-b-2 border-indigo-600 text-indigo-600":"text-gray-600 dark:text-gray-400"}`,children:i("imageEditor.transform")}),t.jsx("button",{onClick:()=>R("adjust"),className:`px-4 py-2 font-medium transition-colors ${v==="adjust"?"border-b-2 border-indigo-600 text-indigo-600":"text-gray-600 dark:text-gray-400"}`,children:i("imageEditor.adjust")})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg",children:[v==="draw"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(ce,{size:18})," ",i("imageEditor.text")]}),t.jsxs("button",{onClick:()=>H("rectangle"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(de,{size:18})," ",i("imageEditor.rectangle")]}),t.jsxs("button",{onClick:()=>H("circle"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(ge,{size:18})," ",i("imageEditor.circle")]}),t.jsxs("button",{onClick:()=>H("triangle"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(he,{size:18})," ",i("imageEditor.triangle")]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("imageEditor.fillColor")}),t.jsx("input",{type:"color",value:k,onChange:a=>q(a.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("imageEditor.strokeColor")}),t.jsx("input",{type:"color",value:D,onChange:a=>V(a.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("imageEditor.fontSize")}),t.jsx("input",{type:"number",value:F,onChange:a=>Z(parseInt(a.target.value)),className:"w-full px-3 py-2 rounded border dark:bg-gray-800"})]})]})]}),v==="transform"&&t.jsx("div",{className:"space-y-3",children:$?t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("imageEditor.adjustCropArea")}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:se,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:i("imageEditor.applyCrop")}),t.jsx("button",{onClick:oe,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:i("imageEditor.cancelCrop")})]})]}):t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:re,className:"flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:i("imageEditor.crop")}),t.jsxs("button",{onClick:()=>W(90),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(M,{size:18})," ",i("imageEditor.rotate90")]}),t.jsxs("button",{onClick:()=>W(180),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(M,{size:18})," ",i("imageEditor.rotate180")]}),t.jsxs("button",{onClick:()=>B("horizontal"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(ue,{size:18})," ",i("imageEditor.flipH")]}),t.jsxs("button",{onClick:()=>B("vertical"),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[t.jsx(me,{size:18})," ",i("imageEditor.flipV")]})]})}),v==="adjust"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i("imageEditor.brightness"),": ",N]}),t.jsx("input",{type:"range",min:"-100",max:"100",value:N,onChange:a=>G(parseInt(a.target.value)),className:"w-full"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i("imageEditor.contrast"),": ",E]}),t.jsx("input",{type:"range",min:"-100",max:"100",value:E,onChange:a=>K(parseInt(a.target.value)),className:"w-full"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i("imageEditor.saturation"),": ",S]}),t.jsx("input",{type:"range",min:"-100",max:"100",value:S,onChange:a=>Q(parseInt(a.target.value)),className:"w-full"})]})]})]}),t.jsxs("div",{className:"flex gap-2 justify-between",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:_,disabled:u<=0,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-30",children:t.jsx(xe,{size:20})}),t.jsx("button",{onClick:ee,disabled:u>=y.length-1,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-30",children:t.jsx(be,{size:20})}),t.jsx("button",{onClick:ne,className:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:t.jsx(pe,{size:20})})]}),t.jsxs("button",{onClick:ie,className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[t.jsx(fe,{size:20})," ",i("imageEditor.download")]})]})]})]})]})})};export{Ae as ImageEditor};
