import{j as e,S as u,U as N,W as R,o as U,V as L}from"./ui-vendor-DEvE63cZ.js";import{r as p}from"./react-vendor-BGp5FbCG.js";import{DropZone as C}from"./DropZone-Ddsx4Ooe.js";import{u as E}from"./index-QRt--NjA.js";import{v as I}from"./utils-vendor-CJFcDo9C.js";import{A as P,m as O}from"./framer-vendor-DEiCTn3G.js";const M=()=>{const{t:l}=E(),[h,i]=p.useState([]),[b,f]=p.useState(""),y=async r=>new Promise((t,s)=>{const a=new Image,x=URL.createObjectURL(r);a.onload=()=>{const g=document.createElement("canvas");g.width=a.width,g.height=a.height;const o=g.getContext("2d");if(!o){URL.revokeObjectURL(x),s(new Error("Could not get canvas context"));return}o.drawImage(a,0,0);const n=Math.max(80,Math.min(a.width,a.height)*.12),c=a.width-n,m=a.height-n;try{const d=Math.max(0,m-n);o.drawImage(a,c,d,n,n,c,m,n,n),o.filter!==void 0&&(o.save(),o.beginPath(),o.rect(c,m-4,n,8),o.clip(),o.filter="blur(5px)",o.drawImage(a,0,0),o.restore())}catch(d){console.error("Failed to apply patch:",d),o.filter!==void 0&&(o.filter="blur(20px)",o.drawImage(a,c,m,n,n,c,m,n,n),o.filter="none")}g.toBlob(d=>{URL.revokeObjectURL(x),d?t(URL.createObjectURL(d)):s(new Error("Canvas conversion failed"))},r.type)},a.onerror=()=>{URL.revokeObjectURL(x),s(new Error("Failed to load image"))},a.src=x}),j=async r=>{i(t=>t.map(s=>s.id===r.id?{...s,status:"processing"}:s));try{const t=await y(r.file);await new Promise(s=>setTimeout(s,1500)),i(s=>s.map(a=>a.id===r.id?{...a,status:"done",processedUrl:t}:a))}catch(t){console.error(t),i(s=>s.map(a=>a.id===r.id?{...a,status:"error",error:l("watermarkRemover.alert.processError")}:a))}},w=p.useCallback(r=>{const t=r.map(s=>({id:I(),file:s,originalUrl:URL.createObjectURL(s),status:"pending"}));i(s=>[...s,...t])},[]),v=r=>{i(t=>{const s=t.find(a=>a.id===r);return s&&URL.revokeObjectURL(s.originalUrl),t.filter(a=>a.id!==r)})},k=r=>{if(!r.processedUrl)return;const t=document.createElement("a");t.href=r.processedUrl,t.download=`clean_${r.file.name}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)};return e.jsxs("div",{className:"flex flex-col h-full max-w-5xl mx-auto p-6 gap-6",children:[e.jsxs("header",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(u,{className:"text-blue-500"}),l("watermarkRemover.title")]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:l("watermarkRemover.description")})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm flex flex-col sm:flex-row gap-4 items-center",children:e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l("watermarkRemover.apiKeyParams")}),e.jsx("input",{type:"password",value:b,onChange:r=>f(r.target.value),placeholder:l("watermarkRemover.apiKeyPlaceholder"),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 outline-none transition-all"})]})}),e.jsx(C,{onFilesDropped:w,accept:"image/*"}),h.length>0&&e.jsx("div",{className:"grid grid-cols-1 gap-6 pb-20",children:e.jsx(P,{children:h.map(r=>e.jsxs(O.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-300 truncate max-w-md",children:r.file.name}),e.jsx("button",{onClick:()=>v(r.id),className:"text-gray-400 hover:text-red-500 transition-colors p-1",children:e.jsx(N,{size:18})})]}),e.jsxs("div",{className:"p-4 sm:p-6 grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-1",children:e.jsx("span",{children:l("watermarkRemover.original")})}),e.jsx("div",{className:"relative aspect-video bg-gray-100 dark:bg-gray-900 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 flex items-center justify-center",children:e.jsx("img",{src:r.originalUrl,alt:"Original",className:"max-h-full max-w-full object-contain"})})]}),e.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[e.jsx("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-1",children:e.jsx("span",{children:l("watermarkRemover.processed")})}),e.jsx("div",{className:"relative aspect-video bg-gray-100 dark:bg-gray-900 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 flex items-center justify-center flex-1",children:r.status==="done"&&r.processedUrl?e.jsx("img",{src:r.processedUrl,alt:"Processed",className:"max-h-full max-w-full object-contain"}):r.status==="processing"?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-blue-500 font-medium animate-pulse",children:l("watermarkRemover.processing")})]}):r.status==="error"?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-red-500 text-center p-4",children:[e.jsx(R,{size:32}),e.jsx("span",{className:"text-sm",children:r.error})]}):e.jsxs("div",{className:"text-gray-400 flex flex-col items-center gap-2",children:[e.jsx(u,{size:32,opacity:.5}),e.jsx("span",{className:"text-sm",children:l("imageEnhancer.clickProcess")})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:r.status==="done"?e.jsxs("button",{onClick:()=>k(r),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-all shadow-sm",children:[e.jsx(U,{size:18}),l("watermarkRemover.download")]}):e.jsx("button",{onClick:()=>j(r),disabled:r.status==="processing",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-all shadow-sm w-full sm:w-auto justify-center",children:r.status==="processing"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),l("watermarkRemover.processing")]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{size:18,fill:"currentColor"}),l("watermarkRemover.process")]})})})]})]})]},r.id))})})]})};export{M as WatermarkRemover};
